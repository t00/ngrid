{"id":"features/grid/virtual-scroll","title":"Virtual Scroll","contents":"<h1 id=\"virtual-scroll\"><a href=\"#virtual-scroll\" aria-hidden><span class=\"icon icon-link\"></span></a>Virtual Scroll</h1>\n<p>Virtual scroll will make sure that the table will only render the rows that are visible (plus some buffer rows) and update them\nwhen the user scroll.</p>\n<p>The visible rows in a table are the rows that fit in a table's <strong>viewport</strong>. In other words, the amount of row's we can fit\nin the total height of the table.</p>\n<p>To calculate the amount of rows that fit in a given height we need:</p>\n<ol>\n<li>The height of the row</li>\n<li>The total height of the table</li>\n</ol>\n<p>The total height is constant (when scrolling) so the height of the row will determine the amount of rows that fit.</p>\n<h2 id=\"row-height-strategy\"><a href=\"#row-height-strategy\" aria-hidden><span class=\"icon icon-link\"></span></a>Row Height Strategy</h2>\n<p>There are 3 strategies, 2 for finding the row height:</p>\n<ul>\n<li><strong>vScrollFixed</strong>: Fixed size strategy. The height is fixed for all rows</li>\n<li><strong>vScrollAuto</strong>: Auto size strategy. The table will calculate the average height based on the actual rows</li>\n</ul>\n<blockquote class=\"info icon\">\n<div class=\"icon-location\"></div>\n Whenever the row height in your table's is fixed, use the fixed height strategy.\n</blockquote>\n<p>And one for disabling virtual scroll: <strong>vScrollNone</strong>.</p>\n<h2 id=\"assigning-a-strategy-to-a-table\"><a href=\"#assigning-a-strategy-to-a-table\" aria-hidden><span class=\"icon icon-link\"></span></a>Assigning a strategy to a table</h2>\n<p>Each strategy is also a directive that we can use to apply a strategy on a table</p>\n<div><div class=\"gatsby-highlight\" data-language=\"html\"><pre class=\"language-html\"><code class=\"language-html\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>pbl-ngrid</span> <span class=\"token attr-name\">vScrollAuto</span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>pbl-ngrid</span><span class=\"token punctuation\">></span></span>\n\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>pbl-ngrid</span> <span class=\"token attr-name\">vScrollFixed</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>48<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>pbl-ngrid</span><span class=\"token punctuation\">></span></span>\n\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>pbl-ngrid</span> <span class=\"token attr-name\">vScrollNone</span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>pbl-ngrid</span><span class=\"token punctuation\">></span></span></code></pre></div></div>\n<div pbl-example-view=\"pbl-virtual-scroll-example\"></div>\n<h2 id=\"global-strategy-default\"><a href=\"#global-strategy-default\" aria-hidden><span class=\"icon icon-link\"></span></a>Global Strategy (default)</h2>\n<p>The global strategy for all tables is <code class=\"language-text\">vScrollAuto</code>. If a virtual scroll strategy is not set the global strategy is used.</p>\n<p>You can configure the global strategy with <code class=\"language-text\">PblNgridModule.forRoot</code>:</p>\n<div><div class=\"gatsby-highlight\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> NgModule <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'@angular/core'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> FixedSizeVirtualScrollStrategy <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'@angular/cdk/scrolling'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> PblNgridModule<span class=\"token punctuation\">,</span> NoVirtualScrollStrategy <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'@pebula/ngrid'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// DISABLING VIRTUAL SCROLL</span>\n\n@<span class=\"token function\">NgModule</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n  imports<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span>\n    PblNgridModule<span class=\"token punctuation\">.</span><span class=\"token function\">forRoot</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n      defaultStrategy<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">NoVirtualScrollStrategy</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">]</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">TablesWithoutVirtualScrollModule</span> <span class=\"token punctuation\">{</span> <span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\">// FIXED SIZE VIRTUAL SCROLL</span>\n\n@<span class=\"token function\">NgModule</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n  imports<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span>\n    PblNgridModule<span class=\"token punctuation\">.</span><span class=\"token function\">forRoot</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n      wheelMode<span class=\"token punctuation\">:</span> <span class=\"token number\">18</span><span class=\"token punctuation\">,</span> <span class=\"token comment\">// default wheel mode</span>\n      defaultStrategy<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">FixedSizeVirtualScrollStrategy</span><span class=\"token punctuation\">(</span><span class=\"token number\">48</span><span class=\"token punctuation\">,</span> <span class=\"token number\">100</span><span class=\"token punctuation\">,</span> <span class=\"token number\">200</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">]</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">TablesWithFixedVirtualScrollModule</span> <span class=\"token punctuation\">{</span> <span class=\"token punctuation\">}</span></code></pre></div></div>\n<blockquote class=\"info icon\">\n<div class=\"icon-location\"></div>\n \n<code class=\"language-text\">NoVirtualScrollStrategy</code>\n is a mode that disable virtual scroll\n</blockquote>\n<h2 id=\"setting-the-table-height\"><a href=\"#setting-the-table-height\" aria-hidden><span class=\"icon icon-link\"></span></a>Setting the Table Height</h2>\n<p>Virtual scroll requires a table with an explicit <code class=\"language-text\">height</code> value set (style/css). All valid units are good (%, px, etc..).</p>\n<blockquote class=\"warn icon\">\n<div class=\"icon-location\"></div>\n If a height is not explicitly set the table's height will be 0.\n</blockquote>\n<blockquote class=\"info icon\">\n<div class=\"icon-location\"></div>\n Without virtual scroll, not having a height will result in a height equal to the sum of all rows.\nWith virtual scroll we calculate how many rows fit in a given height, hence \n<strong>we need a the height pre-hand</strong>\n. We can't\nlet the row's define it.\n</blockquote>\n<h2 id=\"detecting-scrolling-state\"><a href=\"#detecting-scrolling-state\" aria-hidden><span class=\"icon icon-link\"></span></a>Detecting Scrolling State</h2>\n<p>When rows are scrolled vertically the <em>scrolling</em> state is turned on. Detecting changes in the scrolling state is supported through:</p>\n<h3 id=\"scrolling-event\"><a href=\"#scrolling-event\" aria-hidden><span class=\"icon icon-link\"></span></a><code class=\"language-text\">(scrolling)</code> Event</h3>\n<p>Event emitted when the scrolling state of rows in the table changes.</p>\n<p>When scrolling <strong>starts</strong> <code class=\"language-text\">true</code> is emitted and when the scrolling <strong>ends</strong> <code class=\"language-text\">false</code> is emitted.</p>\n<h3 id=\"css-class\"><a href=\"#css-class\" aria-hidden><span class=\"icon icon-link\"></span></a>CSS Class</h3>\n<p>When scrolling starts the CSS class <code class=\"language-text\">pbl-ngrid-scrolling</code> is added to the table (<code class=\"language-text\">pbl-ngrid</code>) and when scrolling ends the CSS class is removed.</p>\n<blockquote class=\"info icon\">\n<div class=\"icon-location\"></div>\n The CSS flag is mostly used for plugins, cell template packs, etc. It requires disabling of component \n<code class=\"language-text\">encapsulation</code>\n, less suitable\nfor application components.\n</blockquote>\n<div pbl-example-view=\"pbl-scrolling-state-example\"></div>\n<h2 id=\"performance\"><a href=\"#performance\" aria-hidden><span class=\"icon icon-link\"></span></a>Performance</h2>\n<p>Without virtual scrolling, loading a datasource with 10,000 rows will takes a lot of time and will probably freeze the browser.</p>\n<p>With virtual scrolling loading is instant but it does not come for free, when scrolling the table will calculate the new scroll position matching\nit to the rows that should appear in that scroll offset and render them on page.</p>\n<p>When the offset is changing gradually the performance impact is minimal but when the change is rapid with large gaps there might be performance issues.</p>\n<blockquote class=\"info icon\">\n<div class=\"icon-location\"></div>\n Performance issues means lower frame rate, which happens when it takes more time to render new rows. This is why larger offset means less performance\nbecause more rows are rendered on each scroll.\n</blockquote>\n<p>Rapid scrolling with large offsets can occur when scrolling with the <strong>wheel</strong> or in mobile with <strong>touch move</strong>.</p>\n<p>In most browsers, when rendering takes more time the end result is an empty table while scrolling. The rows we had at the start are long out of the view but new rows\ndid not have the time to render in the frame.</p>\n<blockquote class=\"warn icon\">\n<div class=\"icon-location\"></div>\n \n<strong>wheelMode</strong>\n works for wheel events, its does not apply for touch events. Messing around with touch behavior on mobile devices will\nmake the scrolling behavior feel un-natural. Scrolling in touch devices, using touch is always passive.\n</blockquote>\n<p>To tackle this the <code class=\"language-text\">[wheelMode]</code> mode directive offers 3 strategies:</p>\n<h3 id=\"passive-default\"><a href=\"#passive-default\" aria-hidden><span class=\"icon icon-link\"></span></a>Passive (default)</h3>\n<p>Do nothing, let the browser handle the rendering and if no rows are shown while browsing let it be.</p>\n<h3 id=\"blocking\"><a href=\"#blocking\" aria-hidden><span class=\"icon icon-link\"></span></a>Blocking</h3>\n<p>Do not let the browser scroll until all rows in the current offset are rendered.</p>\n<p>This will result in a lower scrolling speed with the wheel but with a scrolling UX behavior. The scrolling speed\ndepends on the frame rate, at 60FPS you will not feel a thing but at 5 FPS the experience is bad.</p>\n<h3 id=\"threshold\"><a href=\"#threshold\" aria-hidden><span class=\"icon icon-link\"></span></a>Threshold</h3>\n<p>Provide a frame rate threshold that define when to use <strong>Passive</strong> mode and when to use <strong>Blocking</strong> mode.</p>\n<p>Each scrolling events start with the <strong>Blocking</strong> behavior but when the frame rate drops below the threshold the behavior\nswitch's to <strong>Passive</strong>.</p>\n<p>It is always preferred to render at 60FPS but sometimes it is not possible and we can compromise on lower frame rate in favor of a real UI scroll feel.</p>\n<p>Like all trade-offs, it is best to meet at middle ground. Provide a <strong>threshold</strong> within your limits, usually between 15 FPS to 25 FPS.</p>\n<blockquote class=\"info icon\">\n<div class=\"icon-location\"></div>\n Measuring performance is tricky as it depends on the CPU power of the host, the complexity of the cells, the size of the viewport (row count) and the scroll speed.\nTry to avoid complex cells, \n<strong>Blocking</strong>\n behavior and low \n<strong>threshold</strong>\n values.\n</blockquote>\n<p>For a live example see the <a [routerLink]=\"['../../', 'demos', 'virtual-scroll-performance']\">virtual scroll performance</a> demo.</p>\n<h2 id=\"horizontal-scrolling\"><a href=\"#horizontal-scrolling\" aria-hidden><span class=\"icon icon-link\"></span></a>Horizontal scrolling</h2>\n<p>Virtual scroll currently support vertical scrolling, horizontal scrolling is not supported at the moment.</p>\n"}